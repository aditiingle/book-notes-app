<%- include('partials/header', { title: 'Books List', headerTitle: 'Books List' }) %>

<div class="container" id="currentBookList">
    <h2 id="bookListTitle">Books I've Read</h2><br>
    <ul class="list-unstyled">
        <% booksList.forEach(book => { %>
        <li>
            <div class="p-5 mb-4 bg-body-tertiary rounded-3">
                <div class="container-fluid py-2  d-flex justify-content-between align-items-start">
                    <div class="book-details" >
                    <h1 class="display-5 fw-bold fs-2"><%= book.title %></h1>
                    <p>Author: <%= book.author %></p>
                    <p>Rating: <%= book.rating %></p>
                    <p>Read on: <%= book.recency ? new Date(book.recency).toLocaleDateString() : 'No date available' %></p>
                    <div class="notes-display">
                        <p class="col-md-8"><%= book.notes || 'No notes available' %></p>
                    </div>
                    
                    <a href="/edit/<%= book.id %>" class="btn btn-light btn-sm">Edit</a>
                    <form action="/delete" method="post" style="display:inline;">
                        <input type="hidden" name="deleteBookId" value="<%= book.id %>">
                        <button class="btn btn-warning btn-sm" type="submit">Delete</button>
                    </form>                    
                </div>
                
                <!-- Placeholder for book cover -->
                <div class="book-cover" id="cover-<%= book.isbn %>">
                    <!-- Cover image will be inserted here -->
                </div>
        </li>
        <% }) %>
    </ul>
</div>


<script>
    // Fetch the cover images from the server
    fetch('/covers')
        .then(response => response.json())
        .then(covers => {
            covers.forEach(cover => {
                const coverDiv = document.getElementById('cover-' + cover.isbn); // Select the correct cover div by ISBN
                if (coverDiv && cover.image) {
                    const img = document.createElement('img');
                    img.src = cover.image;
                    img.alt = `Cover for ISBN ${cover.isbn}`;
                    img.style.width = '150px';
                    img.style.margin = '15px';
                    coverDiv.appendChild(img); // Append the image to the corresponding book cover div
                }
            });
        })
        .catch(error => {
            console.error('Error loading covers:', error);
        });
</script>
<%- include('partials/footer') %>
