<%- include('partials/header', { title: 'Search Results', headerTitle: 'Search Results' }) %>

<div class="container">
    <h2>Search Results for "<%= query %>"</h2>
    <% if (booksList.length > 0) { %>
        <ul class="list-unstyled">
            <% booksList.forEach(book => { %>
                <li>
                    <div class="p-5 mb-4 bg-body-tertiary rounded-3">
                        <div class="container-fluid py-2 d-flex align-items-start">
                            <div class="book-details flex-grow-1">
                                <h1 class="display-5 fw-bold fs-2"><%= book.title %></h1>
                                <p>Author: <%= book.author %></p>
                                <p>Rating: <%= book.rating %></p>
                                <p>Read on: <%= book.recency ? new Date(book.recency).toLocaleDateString() : 'No date available' %></p>
                                <div class="notes-display">
                                    <p class="col-md-8"><%= book.notes || 'No notes available' %></p>
                                </div>
                            </div>
                            <!-- Placeholder for book cover, positioned to the right -->
                            <div class="book-cover" id="cover-<%= book.isbn %>">
                                <!-- Cover image will be inserted here -->
                            </div>
                        </div>
                    </div>
                </li>
            <% }) %>
        </ul>
    <% } else { %>
        <p>No books found matching your query.</p>
    <% } %>
</div>

<script>
    // Fetch the cover images from the server
    fetch('/covers')
        .then(response => response.json())
        .then(covers => {
            covers.forEach(cover => {
                const coverDiv = document.getElementById('cover-' + cover.isbn); // Select the correct cover div by ISBN
                if (coverDiv && cover.image) {
                    const img = document.createElement('img');
                    img.src = cover.image;
                    img.alt = `Cover for ISBN ${cover.isbn}`;
                    img.style.width = '150px';
                    img.style.margin = '15px';
                    coverDiv.appendChild(img); // Append the image to the corresponding book cover div
                }
            });
        })
        .catch(error => {
            console.error('Error loading covers:', error);
        });
</script>

<%- include('partials/footer') %>

<style>
    .book-details {
        flex-grow: 1;
    }
    .book-cover {
        flex-shrink: 0;
        margin-left: 20px;
    }
    .book-cover img {
        border-radius: 5px; /* Optional: adds rounded corners to the cover image */
    }
</style>
